-- Test keywords refers to `kwlist.h`
CREATE SCHEMA keywords;
SET CURRENT_SCHEMA TO keywords;
declare
keyword_name varchar;
catcode_name char;
create_sql varchar;
drop_sql varchar;
begin
    for keyword_name,catcode_name in (select word,catcode from pg_get_keywords()) loop
        if catcode_name = 'U' or catcode_name = 'C' then
            create_sql = 'create table keywords.' || keyword_name || '(' || keyword_name|| ' int)';
            drop_sql = 'drop table keywords.' || keyword_name;
        elsif catcode_name = 'T' then
            create_sql = 'create function keywords.' || keyword_name || '() returns int language sql as ''select 1''';
            drop_sql = 'drop function keywords.' || keyword_name;
        else
            continue;
        end if;
        begin
            EXECUTE IMMEDIATE create_sql;
            EXECUTE IMMEDIATE drop_sql;
            EXCEPTION when OTHERS then
            raise notice 'test failed. test sql: %; %;', create_sql, drop_sql;
        end;
    end loop;
end;
/
NOTICE:  test failed. test sql: create table keywords.novalidate(novalidate int); drop table keywords.novalidate;
NOTICE:  test failed. test sql: create table keywords.raw(raw int); drop table keywords.raw;
NOTICE:  test failed. test sql: create table keywords.timezone_hour(timezone_hour int); drop table keywords.timezone_hour;
NOTICE:  test failed. test sql: create table keywords.timezone_minute(timezone_minute int); drop table keywords.timezone_minute;
NOTICE:  test failed. test sql: create table keywords.under(under int); drop table keywords.under;
NOTICE:  test failed. test sql: create table keywords.warnings(warnings int); drop table keywords.warnings;
-- Unreserved keywords
CREATE TABLE following (final int);
DROP TABLE following;
CREATE TYPE following;
DROP TYPE following;
-- Col name keywords
CREATE TABLE float (forward int);
DROP TABLE float;
CREATE TYPE grouping; -- Will fail
ERROR:  syntax error at or near "grouping"
LINE 1: CREATE TYPE grouping;
                    ^
DROP TYPE grouping; -- Will fail
ERROR:  syntax error at or near "grouping"
LINE 1: DROP TYPE grouping;
                  ^
-- Type name keywords
CREATE TABLE full (freeze int); -- Will fail
ERROR:  syntax error at or near "full"
LINE 1: CREATE TABLE full (freeze int);
                     ^
DROP TABLE full; -- Will fail
ERROR:  syntax error at or near "full"
LINE 1: DROP TABLE full;
                   ^
CREATE TYPE full;
DROP TYPE full;
SET CURRENT_SCHEMA TO DEFAULT;
DROP SCHEMA keywords;
